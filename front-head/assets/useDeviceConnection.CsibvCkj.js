import{r as e,o as n,g as o,U as a,z as c,b as l}from"./index-DWDfi1U8.js";import{a as t}from"./device.Cb-AJGsv.js";function i(){const i=e(!1),u=e(null),s=e(null),v=e(!1),r=e(null);async function d(){const e=o("connection");if(!e)return i.value=!1,void(u.value=null);if(Date.now()-e>6e5)f();else if(!v.value)if(o("token"))try{v.value=!0;const e=await t();e&&0===e.code&&e.data&&e.data.length>0?(i.value=!0,u.value=e.data[0],r.value=e.points||null,console.log("检测到已连接设备")):f()}catch(n){console.error("检查设备连接失败:",n)}finally{v.value=!1}else f()}function f(){i.value=!1,u.value=null,l("connection"),console.log("已清除设备连接状态")}function C(){g(),d(),s.value=setInterval(()=>{d()},5e3)}function g(){s.value&&(clearInterval(s.value),s.value=null)}return n(()=>{o("connection")&&C()}),a(()=>{g()}),{hasConnection:i,connectedDevice:u,isChecking:v,points:r,checkDeviceConnection:d,clearConnectionStorage:f,startConnectionCheck:C,stopConnectionCheck:g,goToDeviceConnection:function(){if(u.value){const e=u.value.device_id||u.value.id,n=u.value.device_name||u.value.name;c({url:`/pages/scan/scan?connected=true&device_id=${e}&device_name=${encodeURIComponent(n||"")}`})}else c({url:"/pages/scan/scan"})}}}export{i as u};
