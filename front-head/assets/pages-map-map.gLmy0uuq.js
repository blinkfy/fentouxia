import{C as e,V as t,r as a,P as l,W as o,d as n,t as i,e as s,w as u,f as r,i as c,x as d,m as g,l as p,v as m,q as f,I as v,X as w,y,k as h,J as _,o as b,s as k,K as M,h as C,Y as F,Z as x}from"./index-DWDfi1U8.js";import{c as L}from"./index.D9Dqt54M.js";import{u as $,b as U,r as T,g as P,c as j}from"./map.D58OIJrJ.js";import{_ as A}from"./_plugin-vue_export-helper.BCo6x5W8.js";const E="RZPBZ-AXLY3-ENO3Q-O3AZU-JGX4Q-KTFZU",N="F4BBZ-THI6W-LLRR3-YG74H-NDW43-WCFDH";const I=A({__name:"AddTrashBinModal",props:{visible:{type:Boolean,default:!1},userLocation:{type:Object,default:()=>({})}},emits:["close","success"],setup(b,{emit:k}){const M=b,C=k,F=a({name:"",description:"",latitude:null,longitude:null,address:"",imageUrl:"",imageFile:null}),x=a(!1),L=a(!1),P=a(""),j=a({show:!1,message:"",type:"info",icon:"â„¹ï¸"});function A(e,t="info",a=2e3){const l={success:"âœ…",error:"âŒ",warning:"âš ï¸",info:"â„¹ï¸"};j.value={show:!0,message:e,type:t,icon:l[t]||l.info},setTimeout(()=>{j.value.show=!1},a)}async function E(){if(!x.value){x.value=!0;try{const a=await function(a=null){return new Promise((l,o)=>{const n="undefined"!=typeof window&&!window.wx&&!window.my&&!window.swan;let i=!1;try{"mp-alipay"===e().uniPlatform&&(i=!0,console.log("æ£€æµ‹åˆ°æ”¯ä»˜å®å°ç¨‹åºï¼Œè·³è¿‡typeå‚æ•°"))}catch(s){console.warn("è·å–ç³»ç»Ÿä¿¡æ¯å¤±è´¥:",s)}try{let e=function(){const e={success(e){let t=e.latitude,a=e.longitude;"string"==typeof t&&(t=parseFloat(t)),"string"==typeof a&&(a=parseFloat(a)),!e||"number"!=typeof t||"number"!=typeof a||isNaN(t)||isNaN(a)?(console.warn("å®šä½è¿”å›æ•°æ®æ ¼å¼å¼‚å¸¸:",e),o(new Error("å®šä½è¿”å›æ•°æ®å¼‚å¸¸"))):l({latitude:t,longitude:a})},fail(l){if(l.errMsg&&l.errMsg.includes("æš‚ä¸æ”¯æŒ type")&&a){console.log("æ”¯ä»˜å®å°ç¨‹åºä¸æ”¯æŒtypeå‚æ•°ï¼Œé‡è¯•ä¸ä¼ type");const a={...e};return delete a.type,void t(a)}o(l||new Error("å®šä½å¤±è´¥"))},timeout:15e3};a&&!i&&(e.type=a),t(e)};n&&"undefined"!=typeof navigator&&navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{l({latitude:e.coords.latitude,longitude:e.coords.longitude})},t=>{console.warn("æµè§ˆå™¨å®šä½å¤±è´¥ï¼Œå°è¯•uni.getLocation:",t),e()},{enableHighAccuracy:!0,timeout:1e4}):e()}catch(s){o(s)}})}();F.value.latitude=a.latitude,F.value.longitude=a.longitude,A("ä½ç½®è·å–æˆåŠŸ","success",1500),setTimeout(async()=>{try{await N(a.latitude,a.longitude)}catch(e){console.warn("åœ°å€è§£æå¤±è´¥ï¼Œä½†ä½ç½®è·å–æˆåŠŸ")}},500)}catch(a){console.error("è·å–ä½ç½®å¤±è´¥:",a),A("ä½ç½®è·å–å¤±è´¥ï¼Œè¯·æ£€æŸ¥å®šä½æƒé™","error",2e3)}finally{x.value=!1}}}async function N(e,t){if(!("undefined"!=typeof window&&!window.wx&&!window.my&&!window.swan))try{const a=await T(e,t);if(a&&a.result&&a.result.address)return void(F.value.address=a.result.address)}catch(a){console.warn("è…¾è®¯åœ°å›¾åœ°å€è§£æå¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°è§£æ:",a)}try{const a=[];e>=18&&e<=54&&t>=73&&t<=135?e>=39.4&&e<=41.6&&t>=115.7&&t<=117.4?a.push("åŒ—äº¬å¸‚"):e>=30.4&&e<=32&&t>=120.85&&t<=122.3?a.push("ä¸Šæµ·å¸‚"):e>=22.4&&e<=23.9&&t>=113.1&&t<=114.8?a.push("å¹¿å·å¸‚"):e>=35.5&&e<=37.1&&t>=119.8&&t<=121.1?a.push("é’å²›å¸‚"):e>=44&&e<=46&&t>=125&&t<=128?a.push("å“ˆå°”æ»¨å¸‚"):a.push("ä¸­å›½"):a.push("ä½ç½®"),a.push(`åæ ‡: ${e.toFixed(6)}, ${t.toFixed(6)}`),F.value.address=a.join(" ")}catch(a){console.warn("æœ¬åœ°åœ°å€è§£æä¹Ÿå¤±è´¥:",a),F.value.address=`åæ ‡: ${e.toFixed(6)}, ${t.toFixed(6)}`}}function I(){_({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:e=>{e.tempFilePaths&&e.tempFilePaths.length>0&&(F.value.imageUrl=e.tempFilePaths[0],F.value.imageFile=e.tempFilePaths[0])},fail:e=>{console.error("é€‰æ‹©å›¾ç‰‡å¤±è´¥:",e),A("é€‰æ‹©å›¾ç‰‡å¤±è´¥","error")}})}function W(e){try{console.error("å›¾ç‰‡åŠ è½½é”™è¯¯äº‹ä»¶:",e)}catch(t){}P.value="å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œå¯èƒ½æ˜¯æœ¬åœ°ä¸´æ—¶è·¯å¾„åœ¨ H5 ä¸å¯è®¿é—®æˆ– URL æ ¼å¼ä¸å—æ”¯æŒ"}function Z(){P.value=""}function V(){F.value.imageUrl="",F.value.imageFile=null}async function H(){if(!L.value)if(F.value.name.trim())if(F.value.latitude&&F.value.longitude)if(F.value.imageFile){L.value=!0;try{let t="";if(F.value.imageFile)try{const e=await $(F.value.imageFile);t=e.url||e.path||""}catch(e){console.warn("å›¾ç‰‡ä¸Šä¼ å¤±è´¥ï¼Œç»§ç»­æäº¤:",e)}const a={name:F.value.name.trim(),description:F.value.description.trim(),latitude:F.value.latitude,longitude:F.value.longitude,image:t};await U(a),A("æ–°å¢æˆåŠŸ","success",1500),setTimeout(()=>{C("success",a),R()},1500)}catch(t){console.error("æäº¤å¤±è´¥:",t);A(t.message||t.msg||"æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•","error",2e3)}finally{L.value=!1}}else A("è¯·ä¸Šä¼ åƒåœ¾æ¡¶ç…§ç‰‡","warning");else A("è¯·è·å–ä½ç½®ä¿¡æ¯","warning");else A("è¯·è¾“å…¥åƒåœ¾æ¡¶åç§°","warning")}function R(){C("close")}function B(e){e.target===e.currentTarget&&R()}return l(()=>F.value.name.trim()&&F.value.latitude&&F.value.longitude),o(()=>M.visible,e=>{var t,a;e&&(F.value={name:"",description:"",latitude:null,longitude:null,address:"",imageUrl:"",imageFile:null},(null==(t=M.userLocation)?void 0:t.latitude)&&(null==(a=M.userLocation)?void 0:a.longitude)?(F.value.latitude=M.userLocation.latitude,F.value.longitude=M.userLocation.longitude,setTimeout(()=>{N(M.userLocation.latitude,M.userLocation.longitude)},300)):E())}),(e,t)=>{const a=g,l=c,o=v,_=w,k=y,M=h;return b.visible?(s(),n(l,{key:0,class:"modal-overlay",onClick:B},{default:u(()=>[j.value.show?(s(),n(l,{key:0,class:d(["custom-toast",j.value.type])},{default:u(()=>[r(a,{class:"toast-icon"},{default:u(()=>[p(m(j.value.icon),1)]),_:1}),r(a,{class:"toast-text"},{default:u(()=>[p(m(j.value.message),1)]),_:1})]),_:1},8,["class"])):i("",!0),r(l,{class:"modal-content",onClick:t[2]||(t[2]=f(()=>{},["stop"]))},{default:u(()=>[r(l,{class:"modal-header"},{default:u(()=>[r(a,{class:"modal-title"},{default:u(()=>[p("æ–°å¢åƒåœ¾æ¡¶")]),_:1}),r(a,{class:"modal-close",onClick:R},{default:u(()=>[p("âœ•")]),_:1})]),_:1}),r(l,{class:"modal-body"},{default:u(()=>[r(l,{class:"form-group"},{default:u(()=>[r(a,{class:"form-label"},{default:u(()=>[p("åƒåœ¾æ¡¶åç§° *")]),_:1}),r(o,{class:"form-input",modelValue:F.value.name,"onUpdate:modelValue":t[0]||(t[0]=e=>F.value.name=e),placeholder:"è¯·è¾“å…¥åƒåœ¾æ¡¶åç§°",maxlength:"50"},null,8,["modelValue"])]),_:1}),r(l,{class:"form-group"},{default:u(()=>[r(a,{class:"form-label"},{default:u(()=>[p("æè¿°ä¿¡æ¯ *")]),_:1}),r(_,{class:"form-textarea",modelValue:F.value.description,"onUpdate:modelValue":t[1]||(t[1]=e=>F.value.description=e),placeholder:"è¯·è¾“å…¥æè¿°ä¿¡æ¯ï¼ˆå¦‚ä½ç½®ç‰¹å¾ã€å®¹é‡ç­‰ï¼‰",maxlength:"200"},null,8,["modelValue"])]),_:1}),r(l,{class:"form-group"},{default:u(()=>[r(a,{class:"form-label"},{default:u(()=>[p("ä½ç½®ä¿¡æ¯ *")]),_:1}),r(l,{class:"location-info"},{default:u(()=>[F.value.latitude&&F.value.longitude?(s(),n(a,{key:0,class:"location-text"},{default:u(()=>[p(" ç»çº¬åº¦: "+m(F.value.latitude.toFixed(6))+", "+m(F.value.longitude.toFixed(6)),1)]),_:1})):i("",!0),F.value.address?(s(),n(a,{key:1,class:"location-text"},{default:u(()=>[p(" åœ°å€: "+m(F.value.address),1)]),_:1})):i("",!0),!F.value.address&&F.value.latitude&&F.value.longitude?(s(),n(a,{key:2,class:"location-text location-tip"},{default:u(()=>[p(" åœ°å€è§£æä¸­... ")]),_:1})):i("",!0),r(k,{class:"location-btn",onClick:E,disabled:x.value},{default:u(()=>[p(m(x.value?"è·å–ä¸­...":"é‡æ–°è·å–ä½ç½®"),1)]),_:1},8,["disabled"])]),_:1})]),_:1}),r(l,{class:"form-group"},{default:u(()=>[r(a,{class:"form-label"},{default:u(()=>[p("åƒåœ¾æ¡¶ç…§ç‰‡ *")]),_:1}),r(l,{class:"image-upload"},{default:u(()=>[F.value.imageUrl?(s(),n(l,{key:1,class:"image-preview"},{default:u(()=>[(s(),n(M,{src:F.value.imageUrl,key:F.value.imageUrl,class:"preview-image",mode:"aspectFill",onError:W,onLoad:Z},null,8,["src"])),r(a,{class:"image-remove",onClick:V},{default:u(()=>[p("âœ•")]),_:1}),r(a,{class:"image-debug-url"},{default:u(()=>[p("URL: "+m(F.value.imageUrl),1)]),_:1}),P.value?(s(),n(a,{key:0,class:"image-error"},{default:u(()=>[p("é”™è¯¯: "+m(P.value),1)]),_:1})):i("",!0)]),_:1})):(s(),n(l,{key:0,class:"image-placeholder",onClick:I},{default:u(()=>[r(a,{class:"upload-icon"},{default:u(()=>[p("ğŸ“·")]),_:1}),r(a,{class:"upload-text"},{default:u(()=>[p("ç‚¹å‡»ä¸Šä¼ ç…§ç‰‡")]),_:1})]),_:1}))]),_:1})]),_:1})]),_:1}),r(l,{class:"modal-footer"},{default:u(()=>[r(k,{class:"btn btn-cancel",onClick:R},{default:u(()=>[p("å–æ¶ˆ")]),_:1}),r(k,{class:"btn btn-primary",onClick:H},{default:u(()=>[p(m(L.value?"æäº¤ä¸­...":"ç¡®è®¤æ–°å¢"),1)]),_:1})]),_:1})]),_:1})]),_:1})):i("",!0)}}},[["__scopeId","data-v-76ce479f"]]),W=A({__name:"map",setup(o){const d=a({latitude:36.067108,longitude:120.382609}),f=a({latitude:null,longitude:null,addr:""}),v=a(null),w=a(!1),h=a([]),_=(l(()=>h.value.map(e=>({id:e.id,latitude:"number"==typeof e.latitude?e.latitude:parseFloat(e.latitude),longitude:"number"==typeof e.longitude?e.longitude:parseFloat(e.longitude),title:"smart"===e.type?"æ™ºèƒ½åƒåœ¾æ¡¶":"æ™®é€šåƒåœ¾æ¡¶",iconPath:"smart"===e.type?"/static/smart-marker.png":"/static/normal-marker.png",width:42,height:46,anchor:{x:.5,y:1},callout:{content:"smart"===e.type?"æ™ºèƒ½åƒåœ¾æ¡¶":"æ™®é€šåƒåœ¾æ¡¶",color:"#ffffff",bgColor:"#6a7cfb",padding:6,borderRadius:6,display:"BYCLICK"}}))),a(null));let F=null,$=[];function U(){if(!window.TMap&&!window.tmap)return console.warn("TMap æœªåŠ è½½æˆ– API ç‰ˆæœ¬ä¸å…¼å®¹"),void k({title:"åœ°å›¾ç»„ä»¶åˆå§‹åŒ–å¤±è´¥",icon:"none",duration:3e3});try{const e=new window.TMap.Map("container",{rotation:0,pitch:0,zoom:10,center:new window.TMap.LatLng(d.value.latitude,d.value.longitude)});e.on("error",e=>{console.error("åœ°å›¾åŠ è½½é”™è¯¯:",e),k({title:"åœ°å›¾æ•°æ®åŠ è½½å¼‚å¸¸",icon:"none",duration:3e3})}),F=e,D()}catch(e){console.error("åˆå§‹åŒ–åœ°å›¾æ—¶å‘ç”Ÿé”™è¯¯:",e),k({title:"åœ°å›¾åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•",icon:"none",duration:3e3})}}function T(e){return"data:image/svg+xml;utf8,"+encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='36' height='36' viewBox='0 0 24 24'>\n    <path d='M12 2c-1.1 0-2 .9-2 2v1H8c-1.1 0-2 .9-2 2v7c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2h-2V4c0-1.1-.9-2-2-2z' fill='${"smart"===e?"#2ecc71":"#ff6b6b"}' stroke='#fff' stroke-width='0.5'/>\n    <circle cx='12' cy='15.5' r='1.5' fill='#ffffff'/>\n  </svg>`)}function A(e,t){_.value={id:t.id,title:"smart"===t.type?"æ™ºèƒ½åƒåœ¾æ¡¶":"æ™®é€šåƒåœ¾æ¡¶",latitude:t.latitude,longitude:t.longitude,desc:`åç§°: ${t.name}\nè¯´æ˜: ${t.description||""}`,imageUrl:t.image}}function W(){_.value=null}function Z(e){if(!e)return;const t=window.prompt(`ä¸ŠæŠ¥ ${e.title} çš„é”™è¯¯ä¿¡æ¯ï¼Œè¯·å…·ä½“æè¿°ï¼š`,"");null!==t&&""!==t.trim()?async function(e,t=""){try{const a=e.deviceId||e.id||`${e.latitude},${e.longitude}`;await j(a,t),k({title:"ä¸ŠæŠ¥æˆåŠŸï¼Œæ„Ÿè°¢åé¦ˆ",icon:"success"}),_.value=null}catch(a){console.error("report error failed",a);const e=a&&a.msg?a.msg:a&&a.message?a.message:"ä¸ŠæŠ¥å¤±è´¥";k({title:e,icon:"none"})}}(e,t):k({title:"ä¸ŠæŠ¥å–æ¶ˆæˆ–æœªå¡«å†™åŸå› ",icon:"none"})}function V(){w.value=!0}function H(){w.value=!1}function R(e){console.log("æ–°å¢åƒåœ¾æ¡¶æˆåŠŸ:",e);let t=e.image||"";!t||t.startsWith("http")||t.startsWith("data:")?t||(t=`${L.baseUrl}/static/smart-bin.png`):t=t.startsWith("/")?`${L.baseUrl}${t}`:`${L.baseUrl}/${t}`;const a={id:Date.now(),name:e.name,description:e.description,latitude:"number"==typeof e.latitude?e.latitude:parseFloat(e.latitude),longitude:"number"==typeof e.longitude?e.longitude:parseFloat(e.longitude),image:t,createdAt:(new Date).toISOString(),type:e.type||"normal"};if(h.value.push(a),F&&window.TMap)try{const e=T(a.type),t=new window.TMap.MultiMarker({id:"trash"+a.id,map:F,geometries:[{id:"trash-geo-"+a.id,position:new window.TMap.LatLng(a.latitude,a.longitude),icon:e,title:"smart"===a.type?"æ™ºèƒ½åƒåœ¾æ¡¶":"æ™®é€šåƒåœ¾æ¡¶",width:36,height:36}]});$.push({id:a.id,pointData:a,multiMarker:t}),"function"==typeof t.on&&t.on("click",e=>{A(h.value.length,a)}),F.setCenter(new window.TMap.LatLng(a.latitude,a.longitude)),F.setZoom&&F.setZoom(12)}catch(l){console.warn("H5åœ°å›¾æ·»åŠ æ–°æ ‡è®°å¤±è´¥:",l)}k({title:"åƒåœ¾æ¡¶å·²æäº¤å®¡æ ¸",icon:"success",duration:2e3})}async function B(){try{let e,t;if(f.value.latitude&&f.value.longitude?(e=f.value.latitude,t=f.value.longitude):(e=36.0671,t=120.3826),e&&t){const a=await P({latitude:e,longitude:t,radius:5e3,page:1,pageSize:100});a&&0===a.code&&a.data&&Array.isArray(a.data)?(h.value=a.data.map(e=>{let t=e.image||"";return!t||t.startsWith("http")||t.startsWith("data:")?t||(t=`${L.baseUrl}/static/normal-bin.png`):t=t.startsWith("/")?`${L.baseUrl}${t}`:`${L.baseUrl}/${t}`,{id:e.id,name:e.name,description:e.description,latitude:"number"==typeof e.latitude?e.latitude:parseFloat(e.latitude),longitude:"number"==typeof e.longitude?e.longitude:parseFloat(e.longitude),image:t,createdAt:e.createdAt,type:e.type}}),console.log(`æˆåŠŸåŠ è½½ ${h.value.length} ä¸ªåƒåœ¾æ¡¶æ ‡è®°`),console.log(h.value),F&&($.forEach(e=>{try{e.multiMarker&&"function"==typeof e.multiMarker.remove&&e.multiMarker.remove()}catch(t){console.warn("ç§»é™¤æ—§æ ‡è®°å¤±è´¥:",t)}}),$=[],D())):console.warn("è·å–åƒåœ¾æ¡¶åˆ—è¡¨å“åº”æ ¼å¼å¼‚å¸¸:",a)}else console.warn("ç”¨æˆ·ä½ç½®ä¿¡æ¯ä¸å®Œæ•´ï¼Œæ— æ³•åŠ è½½åƒåœ¾æ¡¶åˆ—è¡¨")}catch(e){console.warn("è·å–åƒåœ¾æ¡¶åˆ—è¡¨å¤±è´¥:",e),k({title:"åŠ è½½åƒåœ¾æ¡¶ä¿¡æ¯å¤±è´¥"+e,icon:"none",duration:2e3})}}function D(){F&&window.TMap&&h.value.forEach((e,t)=>{try{const t=T(e.type),a=new window.TMap.MultiMarker({id:"trash"+e.id,map:F,geometries:[{id:"trash-geo-"+e.id,position:new window.TMap.LatLng(e.latitude,e.longitude),icon:t,title:"smart"===e.type?"æ™ºèƒ½åƒåœ¾æ¡¶":"æ™®é€šåƒåœ¾æ¡¶",width:36,height:36}]});$.push({id:e.id,pointData:e,multiMarker:a}),"function"==typeof a.on&&a.on("click",t=>{A(0,e)})}catch(a){console.warn("åˆ›å»ºæˆ–ç»‘å®š marker æ—¶å‡ºé”™",a)}})}return b(async()=>{{const e=document.createElement("script");e.src=`https://map.qq.com/api/gljs?v=1.exp&key=${E}`,e.onerror=e=>{console.error("åŠ è½½åœ°å›¾è„šæœ¬å¤±è´¥:",e),k({title:"åœ°å›¾åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•",icon:"none",duration:3e3});{console.log("å°è¯•ä½¿ç”¨å¤‡ç”¨å¯†é’¥åŠ è½½åœ°å›¾");const e=document.createElement("script");e.src=`https://map.qq.com/api/gljs?v=1.exp&key=${N}`,e.onload=()=>{U()},e.onerror=()=>{console.error("å¤‡ç”¨å¯†é’¥ä¹Ÿæ— æ³•åŠ è½½åœ°å›¾"),k({title:"åœ°å›¾æœåŠ¡æš‚æ—¶ä¸å¯ç”¨",icon:"none",duration:3e3})},document.head.appendChild(e)}},e.onload=()=>{U()},document.head.appendChild(e)}try{const a=await async function(a="gcj02"){return new Promise((l,o)=>{let n=a;try{const t=e(),a=t.platform,l=t.uniPlatform;("app"===l||"app-plus"===l||"devtools"!==a&&"android"!==a&&"ios"!==a&&"undefined"==typeof window)&&console.log("æ£€æµ‹åˆ°APPç«¯ï¼Œå‡†å¤‡å®šä½"),"mp-alipay"===l&&(console.log("æ£€æµ‹åˆ°æ”¯ä»˜å®å°ç¨‹åºï¼Œä¸ä¼ é€’typeå‚æ•°"),n=null)}catch(s){console.warn("è·å–ç³»ç»Ÿä¿¡æ¯å¤±è´¥:",s)}const i=(e,a=!1)=>{try{const s={success(t){let n=t.latitude,s=t.longitude;"string"==typeof n&&(n=parseFloat(n)),"string"==typeof s&&(s=parseFloat(s)),!t||"number"!=typeof n||"number"!=typeof s||isNaN(n)||isNaN(s)?(console.warn("å®šä½è¿”å›æ•°æ®æ ¼å¼å¼‚å¸¸:",t),a||"gcj02"!==e?o(new Error("å®šä½è¿”å›æ•°æ®å¼‚å¸¸")):(console.log("gcj02å®šä½å¤±è´¥ï¼Œå°è¯•wgs84"),i("wgs84",!0))):(console.log(`å®šä½æˆåŠŸ (${e||"default"}):`,n,s),l({latitude:n,longitude:s}))},fail:t=>(console.warn(`å®šä½å¤±è´¥ (${e||"default"}):`,t),!a&&"gcj02"===e&&t.errMsg&&t.errMsg.includes("not support gcj02")?(console.log("gcj02ä¸æ”¯æŒï¼Œå°è¯•wgs84åæ ‡ç³»"),void i("wgs84",!0)):!a&&t.errMsg&&t.errMsg.includes("æš‚ä¸æ”¯æŒ type")?(console.log("æ”¯ä»˜å®å°ç¨‹åºä¸æ”¯æŒtypeå‚æ•°ï¼Œå°è¯•ä¸ä¼ type"),void i(null,!0)):void("undefined"!=typeof navigator&&navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{console.log("æµè§ˆå™¨å®šä½æˆåŠŸ:",e.coords.latitude,e.coords.longitude),l({latitude:e.coords.latitude,longitude:e.coords.longitude})},e=>{o(t||e||new Error("æµè§ˆå™¨å®šä½å¤±è´¥"))},{enableHighAccuracy:!0,timeout:15e3}):o(t||new Error("å®šä½å¤±è´¥")))),timeout:15e3};e&&null!==n&&(s.type=e),t(s)}catch(s){a||"gcj02"!==n?o(s):i("wgs84",!0)}};i(n)})}("gcj02");if(!a||"number"!=typeof a.latitude)throw new Error("å®šä½ç»“æœä¸å®Œæ•´");d.value={latitude:a.latitude,longitude:a.longitude},f.value={latitude:a.latitude,longitude:a.longitude},v.value={id:"me",latitude:a.latitude,longitude:a.longitude,iconPath:"/static/person.png",width:30,height:46,anchor:{x:.5,y:1},title:"æˆ‘çš„ä½ç½®"},"undefined"!=typeof window&&window.TMap&&F&&(F.setCenter(new window.TMap.LatLng(a.latitude,a.longitude)),F.setZoom&&F.setZoom(12)),await B()}catch(a){console.warn("getLocation failed",a);let e="å®šä½å¤±è´¥";a&&a.errMsg?e=a.errMsg.includes("not support gcj02")?"APPç«¯å®šä½ç³»ç»Ÿä¸æ”¯æŒGCJ02åæ ‡ï¼Œå·²å°è¯•å…¶ä»–åæ ‡ç³»":a.errMsg:a&&a.message&&(e=a.message),k({title:"å®šä½å¤±è´¥ï¼š"+e,icon:"none",duration:2500}),a&&a.errMsg&&(String(a.errMsg).toLowerCase().includes("user denied")||String(a.errMsg).toLowerCase().includes("secure"))?k({title:"å®šä½å¤±è´¥ï¼šæƒé™ä¸è¶³",icon:"none",duration:2500}):a&&a.errMsg&&a.errMsg.includes("not support gcj02")&&M({title:"å®šä½ç³»ç»Ÿæç¤º",content:"APPç«¯ä½¿ç”¨äº†å¤‡ç”¨å®šä½æ–¹æ¡ˆï¼Œåœ°å›¾æ˜¾ç¤ºå¯èƒ½æœ‰è½»å¾®åå·®ï¼Œä½†ä¸å½±å“æ­£å¸¸ä½¿ç”¨ã€‚",showCancel:!1}),await B()}}),(e,t)=>{const a=g,l=c,o=y;return s(),n(l,{class:"map-container"},{default:u(()=>[(s(),C("div",{key:0,id:"container",class:"map-canvas"})),r(l,{class:"add-btn-container"},{default:u(()=>[r(l,{class:"add-btn",onClick:V},{default:u(()=>[r(a,{class:"add-btn-icon"},{default:u(()=>[p("+")]),_:1}),r(a,{class:"add-btn-text"},{default:u(()=>[p("æ–°å¢åƒåœ¾æ¡¶")]),_:1})]),_:1})]),_:1}),_.value?(s(),n(l,{key:2,class:"info-card"},{default:u(()=>[r(l,{class:"info-header"},{default:u(()=>[r(a,{class:"info-title"},{default:u(()=>[p(m(_.value.title),1)]),_:1}),r(a,{class:"info-close",onClick:W},{default:u(()=>[p("âœ•")]),_:1})]),_:1}),r(l,{class:"info-body"},{default:u(()=>[r(a,{class:"info-line"},{default:u(()=>[p("ç»çº¬åº¦: "+m(_.value.latitude)+", "+m(_.value.longitude),1)]),_:1}),_.value.desc?(s(),n(a,{key:0,class:"info-line"},{default:u(()=>[p(m(_.value.desc),1)]),_:1})):i("",!0)]),_:1}),r(l,{class:"info-actions"},{default:u(()=>[r(o,{class:"info-btn",onClick:t[0]||(t[0]=e=>function(e){if(e){const t=`https://uri.amap.com/marker?position=${e.longitude},${e.latitude}&name=${encodeURIComponent(e.title)}&src=yourAppName`;return void window.open(t,"_blank")}}(_.value))},{default:u(()=>[p("å¯¼èˆªåˆ°è¿™é‡Œ")]),_:1}),r(o,{class:"info-btn",onClick:t[1]||(t[1]=e=>{var t;(t=_.value)&&t.imageUrl?(x({urls:[t.imageUrl]}),_.value=null):k({title:"æ²¡æœ‰å›¾ç‰‡",icon:"none"})})},{default:u(()=>[p("æŸ¥çœ‹å›¾ç‰‡")]),_:1}),r(o,{class:"info-btn danger",onClick:t[2]||(t[2]=e=>Z(_.value))},{default:u(()=>[p("æŠ¥é”™")]),_:1})]),_:1})]),_:1})):i("",!0),r(I,{visible:w.value,userLocation:f.value,onClose:H,onSuccess:R},null,8,["visible","userLocation"])]),_:1})}}},[["__scopeId","data-v-6e1f64b0"]]);export{W as default};
