import{r as e,a1 as a,P as l,o as t,E as s,C as c,s as n,d as i,w as o,a as u,Q as f,g as d,b as r,i as m,e as v,f as _,t as g,h,F as y,j as p,n as k,m as b,l as x,v as C,x as R,k as w,q as D,R as P,K as j,M as F,N as z,c as M}from"./index-DWDfi1U8.js";import{g as S,b as $,d as E}from"./history.B0FuC-XM.js";import{_ as B}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./index.D9Dqt54M.js";const H=B({__name:"history",setup(B,{expose:H}){H({onLoad:e=>{e&&e.from&&u("tempReferrer",e.from)}});const I=e([]),L=e(!1),N=e(!1),T=e([]),q=e("all"),A=e(!1),K=e({id:null,image:"",category:"",confidence:0,time:"",source:"",source_name:""}),O=a({page:1,pageSize:20,total:0,totalPages:0}),Q=l(()=>O.page<O.totalPages),G=l(()=>I.value.length>0&&T.value.length===I.value.length),J=e=>{const a=[{left:"15%",animationDelay:"0s"},{left:"75%",animationDelay:"1.5s"},{left:"45%",animationDelay:"3s"},{left:"85%",animationDelay:"4.5s"}];return a[e-1]||a[0]};async function U(e=!1){if(!L.value)try{L.value=!0;const a={page:e?O.page+1:1,pageSize:O.pageSize,source:"all"===q.value?void 0:q.value},l=await S(a),{data:t,pagination:s}=l||{data:[],pagination:{}};e?(I.value=[...I.value,...t],O.page+=1):(I.value=t,O.page=s.page),O.total=s.total,O.totalPages=s.totalPages}catch(a){console.error("åŠ è½½å†å²è®°å½•å¤±è´¥:",a),n({title:a.msg||"åŠ è½½å¤±è´¥",icon:"none"})}finally{L.value=!1}}function V(e){q.value!==e&&(q.value=e,O.page=1,T.value=[],N.value=!1,U())}function W(){Q.value&&!L.value&&U(!0)}function X(){N.value=!N.value,T.value=[]}function Y(){G.value?T.value=[]:T.value=I.value.map(e=>e.id)}async function Z(){if(0!==T.value.length)try{j({title:"ç¡®è®¤åˆ é™¤",content:`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${T.value.length} æ¡è®°å½•å—ï¼Ÿ`,success:async e=>{if(e.confirm){F({title:"åˆ é™¤ä¸­..."});const e=await $(T.value);if(0!==e.code)return z(),void n({title:e.msg||"åˆ é™¤å¤±è´¥",icon:"none"});I.value=I.value.filter(e=>!T.value.includes(e.id)),T.value=[],N.value=!1,z(),n({title:"åˆ é™¤æˆåŠŸ",icon:"success"})}}})}catch(e){console.error("åˆ é™¤å†å²è®°å½•å¤±è´¥:",e),z(),n({title:e.msg||"åˆ é™¤å¤±è´¥",icon:"none"})}}function ee(){A.value=!1}function ae(e){return{online:"åœ¨çº¿è¯†åˆ«",device:"è®¾å¤‡è¯†åˆ«"}[e]||"æœªçŸ¥æ¥æº"}function le(e){const a=new Date(e),l=new Date-a;if(l<6e4)return"åˆšåˆš";if(l<36e5){return`${Math.floor(l/6e4)}åˆ†é’Ÿå‰`}if(l<864e5){return`${Math.floor(l/36e5)}å°æ—¶å‰`}if(l<6048e5){return`${Math.floor(l/864e5)}å¤©å‰`}return a.toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}function te(){f().length>1?P({delta:1,fail:()=>{se()}}):se()}function se(){const e=d("historyReferrer");e?(r("historyReferrer"),setTimeout(()=>{switch(e){case"home":default:M({url:"/pages/home/home"});break;case"profile":M({url:"/pages/profile/profile"});break;case"scan":M({url:"/pages/scan/scan"})}},500)):setTimeout(()=>{M({url:"/pages/home/home"})},500)}return t(()=>{if(function(){const e=f();if(e.length>1){const a=e[e.length-2].route||"";a.includes("home")?u("historyReferrer","home"):a.includes("profile")?u("historyReferrer","profile"):a.includes("scan")?u("historyReferrer","scan"):u("historyReferrer","home")}else{const e=d("tempReferrer")||"home";u("historyReferrer",e),r("tempReferrer")}}(),"undefined"!=typeof document&&document.documentElement){let a=0;try{a=(s?s():c()).statusBarHeight||0}catch(e){a=c().statusBarHeight||0}document.documentElement.style.setProperty("--status-bar-height",a+"px")}U()}),(e,a)=>{const l=m,t=b,s=w;return v(),i(l,{class:"history-bg"},{default:o(()=>[_(l,{class:"custom-statusbar"}),_(l,{class:"tech-bg"},{default:o(()=>[_(l,{class:"tech-grid"}),_(l,{class:"floating-particles"},{default:o(()=>[(v(),h(y,null,p(4,e=>_(l,{class:"particle",key:e,style:k(J(e))},null,8,["style"])),64))]),_:1})]),_:1}),_(l,{class:"history-container"},{default:o(()=>[_(l,{class:"header-section"},{default:o(()=>[_(l,{class:"nav-header"},{default:o(()=>[_(t,{class:"back-btn",onClick:te},{default:o(()=>[x("â†")]),_:1}),_(t,{class:"page-title"},{default:o(()=>[x("è¯†åˆ«å†å²")]),_:1}),_(l,{class:"header-actions"},{default:o(()=>[_(t,{class:"action-btn",onClick:X},{default:o(()=>[x(C(N.value?"å–æ¶ˆ":"ç¼–è¾‘"),1)]),_:1})]),_:1})]),_:1}),_(l,{class:"filter-section"},{default:o(()=>[_(l,{class:"filter-tabs"},{default:o(()=>[_(t,{class:R(["filter-tab",{active:"all"===q.value}]),onClick:a[0]||(a[0]=e=>V("all"))},{default:o(()=>[x("å…¨éƒ¨")]),_:1},8,["class"]),_(t,{class:R(["filter-tab",{active:"online"===q.value}]),onClick:a[1]||(a[1]=e=>V("online"))},{default:o(()=>[x("åœ¨çº¿è¯†åˆ«")]),_:1},8,["class"]),_(t,{class:R(["filter-tab",{active:"device"===q.value}]),onClick:a[2]||(a[2]=e=>V("device"))},{default:o(()=>[x("è®¾å¤‡è¯†åˆ«")]),_:1},8,["class"])]),_:1})]),_:1})]),_:1}),_(l,{class:"history-content"},{default:o(()=>[N.value?(v(),i(l,{key:0,class:"batch-actions"},{default:o(()=>[_(l,{class:"selected-info"},{default:o(()=>[_(l,{class:"select-all-section"},{default:o(()=>[_(t,{class:"select-all-btn",onClick:Y},{default:o(()=>[x(C(G.value?"å–æ¶ˆå…¨é€‰":"å…¨é€‰"),1)]),_:1}),_(t,{class:"selected-count"},{default:o(()=>[x("å·²é€‰æ‹© "+C(T.value.length)+"/"+C(I.value.length)+" é¡¹",1)]),_:1})]),_:1})]),_:1}),T.value.length>0?(v(),i(l,{key:0,class:"batch-buttons"},{default:o(()=>[_(t,{class:"batch-btn delete-btn",onClick:Z},{default:o(()=>[x("åˆ é™¤")]),_:1})]),_:1})):g("",!0)]),_:1})):g("",!0),L.value&&0===I.value.length?(v(),i(l,{key:1,class:"loading-section"},{default:o(()=>[_(l,{class:"loading-spinner"}),_(t,{class:"loading-text"},{default:o(()=>[x("åŠ è½½ä¸­...")]),_:1})]),_:1})):L.value||0!==I.value.length?(v(),i(l,{key:3,class:"history-list"},{default:o(()=>[(v(!0),h(y,null,p(I.value,e=>(v(),i(l,{key:e.id,class:R(["history-item",{selected:T.value.includes(e.id)}]),onClick:a=>N.value?function(e){const a=T.value.indexOf(e);a>-1?T.value.splice(a,1):T.value.push(e)}(e.id):function(e){K.value={...e},A.value=!0}(e)},{default:o(()=>[N.value?(v(),i(l,{key:0,class:"select-checkbox"},{default:o(()=>[_(t,{class:R(["checkbox-icon",{checked:T.value.includes(e.id)}])},{default:o(()=>[x("âœ“")]),_:2},1032,["class"])]),_:2},1024)):g("",!0),_(l,{class:"item-content"},{default:o(()=>[_(l,{class:"item-image"},{default:o(()=>[_(s,{src:e.image,mode:"aspectFill",class:"history-image"},null,8,["src"]),_(l,{class:R(["source-badge",e.source])},{default:o(()=>[_(t,{class:"source-text"},{default:o(()=>[x(C(ae(e.source)),1)]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024),_(l,{class:"item-details"},{default:o(()=>[_(l,{class:"item-header"},{default:o(()=>[_(t,{class:"category-name"},{default:o(()=>[x(C(e.category),1)]),_:2},1024),_(l,{class:"confidence-badge"},{default:o(()=>[_(t,{class:"confidence-text"},{default:o(()=>[x(C((100*e.confidence).toFixed(1))+"%",1)]),_:2},1024)]),_:2},1024)]),_:2},1024),_(t,{class:"item-time"},{default:o(()=>[x(C(le(e.time)),1)]),_:2},1024),e.source_name?(v(),i(t,{key:0,class:"source-name"},{default:o(()=>[x(C(e.source_name),1)]),_:2},1024)):g("",!0)]),_:2},1024),N.value?g("",!0):(v(),i(l,{key:0,class:"item-actions"},{default:o(()=>[_(t,{class:"action-icon",onClick:D(a=>async function(e){try{j({title:"ç¡®è®¤åˆ é™¤",content:"ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ",success:async a=>{if(a.confirm){F({title:"åˆ é™¤ä¸­..."});const a=await E(e);if(0!==a.code)return z(),void n({title:a.msg||"åˆ é™¤å¤±è´¥",icon:"none"});I.value=I.value.filter(a=>a.id!==e),z(),n({title:"åˆ é™¤æˆåŠŸ",icon:"success"})}}})}catch(a){console.error("åˆ é™¤å†å²è®°å½•å¤±è´¥:",a),z(),n({title:a.msg||"åˆ é™¤å¤±è´¥",icon:"none"})}}(e.id),["stop"])},{default:o(()=>[x("ğŸ—‘ï¸")]),_:2},1032,["onClick"])]),_:2},1024))]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})):(v(),i(l,{key:2,class:"empty-section"},{default:o(()=>[_(t,{class:"empty-icon"},{default:o(()=>[x("ğŸ“‹")]),_:1}),_(t,{class:"empty-title"},{default:o(()=>[x("æš‚æ— å†å²è®°å½•")]),_:1}),_(t,{class:"empty-desc"},{default:o(()=>[x("å¼€å§‹ä½¿ç”¨AIè¯†åˆ«åŠŸèƒ½")]),_:1}),_(t,{class:"empty-desc"},{default:o(()=>[x("è®°å½•å°†åœ¨è¿™é‡Œæ˜¾ç¤º")]),_:1})]),_:1})),Q.value&&!L.value?(v(),i(l,{key:4,class:"load-more",onClick:W},{default:o(()=>[_(t,{class:"load-more-text"},{default:o(()=>[x("åŠ è½½æ›´å¤š")]),_:1})]),_:1})):g("",!0),L.value&&I.value.length>0?(v(),i(l,{key:5,class:"loading-more"},{default:o(()=>[_(l,{class:"loading-spinner small"}),_(t,{class:"loading-text"},{default:o(()=>[x("åŠ è½½ä¸­...")]),_:1})]),_:1})):g("",!0),_(l,{class:"loading-more2"},{default:o(()=>[L.value||Q.value?g("",!0):(v(),i(t,{key:0,class:"empty-desc2"},{default:o(()=>[x("è¯†åˆ«è®°å½•ä»…ä¿ç•™45å¤©")]),_:1}))]),_:1})]),_:1})]),_:1}),A.value?(v(),i(l,{key:0,class:"detail-modal",onClick:ee},{default:o(()=>[_(l,{class:"detail-content",onClick:a[3]||(a[3]=D(()=>{},["stop"]))},{default:o(()=>[_(l,{class:"detail-close",onClick:ee},{default:o(()=>[_(t,{class:"close-icon"},{default:o(()=>[x("âœ•")]),_:1})]),_:1}),_(l,{class:"detail-image-section"},{default:o(()=>[_(s,{src:K.value.image,mode:"aspectFit",class:"detail-image"},null,8,["src"])]),_:1}),_(l,{class:"detail-info"},{default:o(()=>[_(l,{class:"info-item"},{default:o(()=>[_(t,{class:"info-label"},{default:o(()=>[x("åˆ†ç±»ç»“æœ")]),_:1}),_(t,{class:"info-value"},{default:o(()=>[x(C(K.value.category),1)]),_:1})]),_:1}),_(l,{class:"info-item"},{default:o(()=>[_(t,{class:"info-label"},{default:o(()=>[x("ç½®ä¿¡åº¦")]),_:1}),_(l,{class:"confidence-bar"},{default:o(()=>[_(l,{class:"confidence-fill",style:k({width:100*K.value.confidence+"%"})},null,8,["style"]),_(t,{class:"confidence-value"},{default:o(()=>[x(C((100*K.value.confidence).toFixed(1))+"%",1)]),_:1})]),_:1})]),_:1}),_(l,{class:"info-item"},{default:o(()=>[_(t,{class:"info-label"},{default:o(()=>[x("è¯†åˆ«æ—¶é—´")]),_:1}),_(t,{class:"info-value"},{default:o(()=>[x(C(le(K.value.time)),1)]),_:1})]),_:1}),_(l,{class:"info-item"},{default:o(()=>[_(t,{class:"info-label"},{default:o(()=>[x("è¯†åˆ«æ¥æº")]),_:1}),_(t,{class:"info-value"},{default:o(()=>[x(C(ae(K.value.source)),1)]),_:1})]),_:1}),K.value.source_name?(v(),i(l,{key:0,class:"info-item"},{default:o(()=>[_(t,{class:"info-label"},{default:o(()=>[x("è®¾å¤‡ä¿¡æ¯")]),_:1}),_(t,{class:"info-value"},{default:o(()=>[x(C(K.value.source_name),1)]),_:1})]),_:1})):g("",!0)]),_:1})]),_:1})]),_:1})):g("",!0)]),_:1})}}},[["__scopeId","data-v-eef8e46c"]]);export{H as default};
