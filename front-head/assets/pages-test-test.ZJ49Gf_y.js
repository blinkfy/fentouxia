import{r as a,P as e,o as n,g as s,s as t,b as i,d as c,w as l,a as r,z as o,Q as u,R as d,c as y,i as m,J as g,e as f,f as p,l as v,v as h,h as w,F as S,j as _,x as $,m as O,S as T,y as J}from"./index-DWDfi1U8.js";import{a as N,c as I}from"./health.CUrxMddd.js";import{g as b,r as k,l as E,a as P}from"./user.kUnp2BN6.js";import{c as D,g as j,a as G}from"./device.Cb-AJGsv.js";import{g as U,d as z}from"./history.B0FuC-XM.js";import{r as x}from"./recognize.CbDo6teM.js";import{g as A}from"./ranking.CCV_N0bo.js";import{s as F,r as L,a as B}from"./map.D58OIJrJ.js";import{g as C,c as H,u as q,d as M,a as Q,b as R,e as K,f as V,h as W,i as X,j as Y,k as Z,l as aa,m as ea,n as na,o as sa,p as ta}from"./database.BkGiDpRw.js";import{_ as ia}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./index.D9Dqt54M.js";const ca=ia({__name:"test",setup(ia){const ca=a(""),la=a(!1),ra=a("health"),oa=a("æœªç™»å½•"),ua=[{key:"health",name:"å¥åº·",icon:"â¤ï¸"},{key:"user",name:"ç”¨æˆ·",icon:"ðŸ‘¤"},{key:"device",name:"è®¾å¤‡",icon:"ðŸ“±"},{key:"history",name:"åŽ†å²",icon:"ðŸ“"},{key:"recognize",name:"è¯†åˆ«",icon:"ðŸ”"},{key:"ranking",name:"æŽ’è¡Œ",icon:"ðŸ†"},{key:"map",name:"åœ°å›¾",icon:"ðŸ—ºï¸"},{key:"database",name:"æ•°æ®åº“",icon:"ðŸ’¾"}],da=[{category:"health",name:"å¥åº·æ£€æŸ¥",desc:"GET /health",handler:async function(){const a=await N();ca.value+=`\nâœ… æˆåŠŸ:\n${JSON.stringify(a,null,2)}`}},{category:"health",name:"æ•°æ®åº“æ£€æŸ¥",desc:"GET api/_db_state",handler:async function(){const a=await I();ca.value+=`\nâœ… æˆåŠŸ:\n${JSON.stringify(a,null,2)}`}},{category:"user",name:"ç”¨æˆ·æ³¨å†Œ",desc:"POST /api/register",handler:async function(){const a=`test_api_${Date.now()}`,e=await k({username:a,password:"test123456"});ca.value+=`\nâœ… æ³¨å†ŒæˆåŠŸ (æµ‹è¯•è´¦å·: ${a}):\n${JSON.stringify(e,null,2)}`}},{category:"user",name:"ç”¨æˆ·ç™»å½•",desc:"POST /api/login",handler:async function(){const a=await E({username:"admin",password:"123456"});ca.value+=`\nâœ… ç™»å½•æˆåŠŸ:\n${JSON.stringify(a,null,2)}`,ga()}},{category:"user",name:"èŽ·å–ç”¨æˆ·ä¿¡æ¯",desc:"GET /api/userinfo",handler:async function(){const a=await b();ca.value+=`\nâœ… ç”¨æˆ·ä¿¡æ¯:\n${JSON.stringify(a,null,2)}`}},{category:"user",name:"ç”¨æˆ·ç™»å‡º",desc:"POST /api/logout",handler:async function(){const a=await P();ca.value+=`\nâœ… ç™»å‡ºæˆåŠŸ:\n${JSON.stringify(a,null,2)}`,ga()}},{category:"user",name:"ä¿®æ”¹å¯†ç ",desc:"POST /api/change_password",handler:async function(){ca.value+="\nâš ï¸ ä¿®æ”¹å¯†ç æµ‹è¯•å·²ç¦ç”¨ï¼Œè¯·åœ¨å®žé™…é¡µé¢æ‰‹åŠ¨æµ‹è¯•ä»¥é¿å…å½±å“çœŸå®žè´¦å·"}},{category:"device",name:"è¿žæŽ¥è®¾å¤‡",desc:"POST /api/device/connect",handler:async function(){const a=`test_device_${Date.now()}`,e=await D(a,"test_token_123",s("token"));ca.value+=`\nâœ… è¿žæŽ¥è®¾å¤‡ (æµ‹è¯•è®¾å¤‡: ${a}):\n${JSON.stringify(e,null,2)}`}},{category:"device",name:"èŽ·å–è®¾å¤‡çŠ¶æ€",desc:"GET /api/device/status",handler:async function(){const a=await j();ca.value+=`\nâœ… è®¾å¤‡çŠ¶æ€ (ä¸å­˜åœ¨çš„æµ‹è¯•è®¾å¤‡):\n${JSON.stringify(a,null,2)}`}},{category:"device",name:"èŽ·å–å·²è¿žæŽ¥è®¾å¤‡",desc:"GET /api/user/connected-devices",handler:async function(){const a=await G();ca.value+=`\nâœ… å·²è¿žæŽ¥è®¾å¤‡:\n${JSON.stringify(a,null,2)}`}},{category:"history",name:"èŽ·å–è¯†åˆ«åŽ†å²",desc:"GET /api/recognition_history",handler:async function(){const a=await U({page:1,pageSize:10});ca.value+=`\nâœ… è¯†åˆ«åŽ†å²:\n${JSON.stringify(a,null,2)}`}},{category:"history",name:"åˆ é™¤åŽ†å²è®°å½•",desc:"DELETE /api/delete_history/:id",handler:async function(){const a=await z(-999999);ca.value+=`\nâœ… åˆ é™¤åŽ†å² (æµ‹è¯•ID: -999999ï¼Œä¸å­˜åœ¨):\n${JSON.stringify(a,null,2)}`}},{category:"recognize",name:"å›¾ç‰‡è¯†åˆ«",desc:"POST /api/recognize",handler:async function(){ca.value+="\nðŸ“· é€‰æ‹©å›¾ç‰‡ä¸­...";try{const e=await new Promise((a,e)=>{g({count:1,sourceType:["album","camera"],success:a,fail:e})}),n=e.tempFilePaths?e.tempFilePaths[0]:e.tempFilePath||"";if(!n)return void(ca.value+="\nâŒ æœªé€‰æ‹©å›¾ç‰‡");ca.value+=`\nâœ… å·²é€‰æ‹©: ${n}`;let s=n;try{if("undefined"!=typeof window&&"function"==typeof window.compressImage){const a=await window.compressImage(n,.8,1024),e=Date.now();s=new File([a],`test_${e}.jpg`,{type:"image/jpeg"})}else if("function"==typeof uni.compressImage){s=(await new Promise((a,e)=>{uni.compressImage({src:n,quality:80,success:a,fail:e})})).tempFilePath||n}}catch(a){console.warn("å›¾ç‰‡åŽ‹ç¼©å¤±è´¥ï¼Œä½¿ç”¨åŽŸå›¾ä¸Šä¼ :",a),s=n}ca.value+="\nâ¬†ï¸ ä¸Šä¼ å¹¶è¯†åˆ«ä¸­...";const t=await x(s);ca.value+=`\nâœ… è¯†åˆ«ç»“æžœ:\n${JSON.stringify(t,null,2)}`}catch(e){ca.value+=`\nâŒ å›¾ç‰‡è¯†åˆ«å¤±è´¥: ${e&&e.errMsg?e.errMsg:e.message||JSON.stringify(e)}`}}},{category:"ranking",name:"èŽ·å–æŽ’è¡Œæ¦œ",desc:"GET /api/ranking",handler:async function(){const a=await A();ca.value+=`\nâœ… æŽ’è¡Œæ¦œ:\n${JSON.stringify(a,null,2)}`}},{category:"map",name:"æœç´¢åœ°ç‚¹",desc:"è…¾è®¯åœ°å›¾ API",handler:async function(){const a=await F("åžƒåœ¾æ¡¶",39.908823,116.39747,1e3);ca.value+=`\nâœ… æœç´¢åœ°ç‚¹:\n${JSON.stringify(a,null,2)}`}},{category:"map",name:"é€†åœ°å€è§£æž",desc:"è…¾è®¯åœ°å›¾ API",handler:async function(){const a=await L(39.908823,116.39747);ca.value+=`\nâœ… é€†åœ°å€è§£æž:\n${JSON.stringify(a,null,2)}`}},{category:"map",name:"é™„è¿‘æœç´¢",desc:"è…¾è®¯åœ°å›¾ API",handler:async function(){const a=await B("åžƒåœ¾æ¡¶",39.908823,116.39747,1e3);ca.value+=`\nâœ… é™„è¿‘æœç´¢:\n${JSON.stringify(a,null,2)}`}},{category:"database",name:"[Users] èŽ·å–åˆ—è¡¨",desc:"GET /api/admin/users",handler:async function(){const a=await C({page:1,pageSize:10});ca.value+=`\nâœ… ç”¨æˆ·åˆ—è¡¨ (åªè¯»æ“ä½œ):\n${JSON.stringify(a,null,2)}`}},{category:"database",name:"[Users] åˆ›å»ºç”¨æˆ·",desc:"POST /api/admin/users",handler:async function(){const a=`test_api_user_${Date.now()}`,e=await H({username:a,password:"test123456",points:0});ca.value+=`\nâœ… åˆ›å»ºç”¨æˆ· (æµ‹è¯•ç”¨æˆ·: ${a}):\n${JSON.stringify(e,null,2)}`}},{category:"database",name:"[Users] æ›´æ–°ç”¨æˆ·",desc:"PUT /api/admin/users/:id",handler:async function(){const a=await q(-1,{points:100});ca.value+=`\nâœ… æ›´æ–°ç”¨æˆ· (æµ‹è¯•ID: -1ï¼Œä¸å­˜åœ¨):\n${JSON.stringify(a,null,2)}`}},{category:"database",name:"[Users] åˆ é™¤ç”¨æˆ·",desc:"DELETE /api/admin/users/:id",handler:async function(){const a=await M(-999999);ca.value+=`\nâœ… åˆ é™¤ç”¨æˆ· (æµ‹è¯•ID: -999999ï¼Œä¸å­˜åœ¨):\n${JSON.stringify(a,null,2)}`}},{category:"database",name:"[Bin] èŽ·å–åˆ—è¡¨",desc:"GET /api/admin/bins",handler:async function(){const a=await Q({page:1,pageSize:10});ca.value+=`\nâœ… åžƒåœ¾æ¡¶åˆ—è¡¨ (åªè¯»æ“ä½œ):\n${JSON.stringify(a,null,2)}`}},{category:"database",name:"[Bin] åˆ›å»ºåžƒåœ¾æ¡¶",desc:"POST /api/admin/bins",handler:async function(){const a=`TEST_BIN_${Date.now()}`,e=await R({name:a,type:"normal",status:"offline",review:!1,latitude:0,longitude:0});ca.value+=`\nâœ… åˆ›å»ºåžƒåœ¾æ¡¶ (æµ‹è¯•åžƒåœ¾æ¡¶: ${a}):\n${JSON.stringify(e,null,2)}`}},{category:"database",name:"[Bin] æ›´æ–°åžƒåœ¾æ¡¶",desc:"PUT /api/admin/bins/:id",handler:async function(){const a=await K(-1,{status:"online"});ca.value+=`\nâœ… æ›´æ–°åžƒåœ¾æ¡¶ (æµ‹è¯•ID: -1ï¼Œä¸å­˜åœ¨):\n${JSON.stringify(a,null,2)}`}},{category:"database",name:"[Bin] åˆ é™¤åžƒåœ¾æ¡¶",desc:"DELETE /api/admin/bins/:id",handler:async function(){const a=await V(-2);ca.value+=`\nâœ… åˆ é™¤åžƒåœ¾æ¡¶ (æµ‹è¯•ID: -2ï¼Œä¸å­˜åœ¨):\n${JSON.stringify(a,null,2)}`}},{category:"database",name:"[UserDevice] èŽ·å–åˆ—è¡¨",desc:"GET /api/admin/user-devices",handler:async function(){const a=await W({page:1,pageSize:10});ca.value+=`\nâœ… ç”¨æˆ·è®¾å¤‡åˆ—è¡¨ (åªè¯»æ“ä½œ):\n${JSON.stringify(a,null,2)}`}},{category:"database",name:"[UserDevice] åˆ›å»ºå…³è”",desc:"POST /api/admin/user-devices",handler:async function(){const a=await X({userId:-1,deviceId:-1});ca.value+=`\nâœ… åˆ›å»ºç”¨æˆ·è®¾å¤‡ (æµ‹è¯•ID: userId=-1, deviceId=-1ï¼Œä¸å­˜åœ¨):\n${JSON.stringify(a,null,2)}`}},{category:"database",name:"[UserDevice] æ›´æ–°å…³è”",desc:"PUT /api/admin/user-devices/:userId/:deviceId",handler:async function(){const a=await Y(-1,-1,{});ca.value+=`\nâœ… æ›´æ–°ç”¨æˆ·è®¾å¤‡ (æµ‹è¯•ID: userId=-1, deviceId=-1ï¼Œä¸å­˜åœ¨):\n${JSON.stringify(a,null,2)}`}},{category:"database",name:"[UserDevice] åˆ é™¤å…³è”",desc:"DELETE /api/admin/user-devices/:userId/:deviceId",handler:async function(){const a=await Z(-2,-2);ca.value+=`\nâœ… åˆ é™¤ç”¨æˆ·è®¾å¤‡ (æµ‹è¯•ID: userId=-2, deviceId=-2ï¼Œä¸å­˜åœ¨):\n${JSON.stringify(a,null,2)}`}},{category:"database",name:"[History] èŽ·å–åˆ—è¡¨",desc:"GET /api/admin/history",handler:async function(){const a=await aa({page:1,pageSize:10});ca.value+=`\nâœ… åŽ†å²è®°å½•åˆ—è¡¨ (åªè¯»æ“ä½œ):\n${JSON.stringify(a,null,2)}`}},{category:"database",name:"[History] åˆ›å»ºè®°å½•",desc:"POST /api/admin/history",handler:async function(){const a=await ea({userId:-1,category:"TEST_API_æµ‹è¯•åˆ†ç±»",source:"online",confidence:99,image_url:"test_api_image.jpg"});ca.value+=`\nâœ… åˆ›å»ºåŽ†å²è®°å½• (æµ‹è¯•æ•°æ®: userId=-1):\n${JSON.stringify(a,null,2)}`}},{category:"database",name:"[History] æ›´æ–°è®°å½•",desc:"PUT /api/admin/history/:id",handler:async function(){const a=await na(-1,{confidence:98});ca.value+=`\nâœ… æ›´æ–°åŽ†å²è®°å½• (æµ‹è¯•ID: -1ï¼Œä¸å­˜åœ¨):\n${JSON.stringify(a,null,2)}`}},{category:"database",name:"[History] åˆ é™¤è®°å½•",desc:"DELETE /api/admin/history/:id",handler:async function(){const a=await sa(-999999);ca.value+=`\nâœ… åˆ é™¤åŽ†å²è®°å½• (æµ‹è¯•ID: -999999ï¼Œä¸å­˜åœ¨):\n${JSON.stringify(a,null,2)}`}},{category:"database",name:"èŽ·å–æ•°æ®åº“ç»Ÿè®¡",desc:"GET /api/admin/stats",handler:async function(){const a=await ta();ca.value+=`\nâœ… æ•°æ®åº“ç»Ÿè®¡:\n${JSON.stringify(a,null,2)}`}}],ya=e(()=>da.filter(a=>a.category===ra.value));function ma(){ca.value=""}function ga(){const a=s("token");oa.value=a?"å·²ç™»å½• âœ…":"æœªç™»å½• âŒ",a||(r("autoLogin",!1),o({url:"/pages/index/index"}))}function fa(){u().length>1?d():y({url:"/pages/index/index"})}return n(async()=>{ga();s("isAdmin")||(t({title:"æ— æƒé™è®¿é—®",icon:"none"}),setTimeout(()=>{fa()},1e3));try{const a=await b();a&&a.data&&a.data.isAdmin||(i("isAdmin"),t({title:"æƒé™å·²è¿‡æœŸæˆ–è¢«æ’¤é”€",icon:"none"}),setTimeout(()=>{fa()},1e3))}catch(a){console.error("æƒé™éªŒè¯å¤±è´¥:",a),t({title:"æƒé™éªŒè¯å¤±è´¥ï¼Œè¯·é‡æ–°ç™»å½•",icon:"none"}),setTimeout(()=>{fa()},1e3)}}),(a,e)=>{const n=m,s=O,t=J,i=T;return f(),c(n,{class:"test-page"},{default:l(()=>[p(n,{class:"header"},{default:l(()=>[p(n,{class:"test-title"},{default:l(()=>[v("â˜ API æµ‹è¯•ä¸­å¿ƒ")]),_:1}),p(n,{class:"token-info"},{default:l(()=>[v("Token: "+h(oa.value),1)]),_:1})]),_:1}),p(n,{class:"categories-container"},{default:l(()=>[p(n,{class:"categories"},{default:l(()=>[(f(),w(S,null,_(ua,a=>p(n,{key:a.key,class:$(["category-item",{active:ra.value===a.key}]),onClick:e=>ra.value=a.key},{default:l(()=>[p(s,null,{default:l(()=>[v(h(a.icon)+" "+h(a.name),1)]),_:2},1024)]),_:2},1032,["class","onClick"])),64))]),_:1})]),_:1}),p(i,{class:"apis-scroll","scroll-y":""},{default:l(()=>[p(n,{class:"api-grid"},{default:l(()=>[(f(!0),w(S,null,_(ya.value,a=>(f(),c(n,{class:"api-group",key:a.name},{default:l(()=>[p(n,{class:"api-name"},{default:l(()=>[v(h(a.name),1)]),_:2},1024),p(n,{class:"api-desc"},{default:l(()=>[v(h(a.desc),1)]),_:2},1024),p(t,{onClick:e=>async function(a){la.value=!0,ca.value=`æ­£åœ¨æµ‹è¯•: ${a.name}...\n`;try{await a.handler()}catch(e){ca.value+=`\nâŒ é”™è¯¯: ${e.message||JSON.stringify(e)}`}finally{la.value=!1}}(a),class:"test-btn",disabled:la.value},{default:l(()=>[v(h(la.value?"æµ‹è¯•ä¸­...":"æµ‹è¯•"),1)]),_:2},1032,["onClick","disabled"])]),_:2},1024))),128))]),_:1})]),_:1}),p(n,{class:"test-result"},{default:l(()=>[p(n,{class:"result-header"},{default:l(()=>[p(s,{class:"result-title"},{default:l(()=>[v("æµ‹è¯•ç»“æžœ")]),_:1}),p(t,{onClick:ma,class:"clear-btn"},{default:l(()=>[v("æ¸…ç©º")]),_:1})]),_:1}),p(i,{class:"result-content","scroll-y":""},{default:l(()=>[p(s,null,{default:l(()=>[v(h(ca.value||"æš‚æ— æµ‹è¯•ç»“æžœ"),1)]),_:1})]),_:1})]),_:1})]),_:1})}}},[["__scopeId","data-v-9d7457ab"]]);export{ca as default};
