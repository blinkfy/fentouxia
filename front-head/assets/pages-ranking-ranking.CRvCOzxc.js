import{r as a,o as e,g as s,s as l,d as t,w as n,a as r,Q as c,b as u,i as o,e as i,f as d,t as f,h as _,F as m,j as p,n as g,m as k,l as v,x as h,v as y,R as b,c as R}from"./index-DWDfi1U8.js";import{g as w}from"./ranking.CCV_N0bo.js";import{_ as x}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./index.D9Dqt54M.js";const j=x({__name:"ranking",setup(x,{expose:j}){const C=a(null),D=a(!1),L=a("");j({onLoad:a=>{a&&a.from&&r("tempReferrer",a.from)}});e(async()=>{(()=>{const a=c();if(a.length>1){const e=a[a.length-2].route||"";e.includes("home")?r("rankingReferrer","home"):e.includes("profile")?r("rankingReferrer","profile"):e.includes("scan")?r("rankingReferrer","scan"):r("rankingReferrer","home")}else{const a=s("tempReferrer")||"home";r("rankingReferrer",a),u("tempReferrer")}})();const a=s("savedUser");a&&a.username&&(L.value=a.username),await N()});const N=async()=>{try{D.value=!0;const a=await w();0===a.code?C.value=a.data:l({title:a.msg||"èŽ·å–æŽ’è¡Œæ¦œå¤±è´¥",icon:"none"})}catch(a){console.error("åŠ è½½æŽ’è¡Œæ¦œå¤±è´¥:",a),l({title:"ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åŽé‡è¯•",icon:"none"})}finally{D.value=!1}},T=async()=>{await N(),l({title:"åˆ·æ–°æˆåŠŸ",icon:"success"})},z=()=>{c().length>1?b({delta:1,fail:()=>{console.log("navigateBack failed, using backup navigation"),S()}}):(console.log("No previous page in stack, using backup navigation"),S())},S=()=>{const a=s("rankingReferrer");a?(u("rankingReferrer"),setTimeout(()=>{switch(a){case"home":default:R({url:"/pages/home/home"});break;case"profile":R({url:"/pages/profile/profile"});break;case"scan":R({url:"/pages/scan/scan"})}},500)):setTimeout(()=>{R({url:"/pages/home/home"})},500)},A=a=>new Date(a).toLocaleDateString("zh-CN",{month:"short",day:"numeric"});return(a,e)=>{const s=o,l=k;return i(),t(s,{class:"ranking-container"},{default:n(()=>[d(s,{class:"tech-background"},{default:n(()=>[d(s,{class:"grid-overlay"}),d(s,{class:"floating-particles"},{default:n(()=>[(i(),_(m,null,p(8,a=>d(s,{class:"particle",key:a,style:g({animationDelay:.3*a+"s"})},null,8,["style"])),64))]),_:1}),d(s,{class:"data-streams"},{default:n(()=>[(i(),_(m,null,p(4,a=>d(s,{class:"stream",key:a})),64))]),_:1})]),_:1}),d(s,{class:"navbar"},{default:n(()=>[d(s,{class:"safe-area-top"}),d(s,{class:"nav-content"},{default:n(()=>[d(s,{class:"nav-left"},{default:n(()=>[d(l,{class:"back-btn",onClick:z},{default:n(()=>[v("â†")]),_:1})]),_:1}),d(l,{class:"nav-title"},{default:n(()=>[v("çŽ¯ä¿æŽ’è¡Œæ¦œ")]),_:1}),d(s,{class:"nav-right"},{default:n(()=>[d(l,{class:h(["refresh-btn",{rotating:D.value}]),onClick:T},{default:n(()=>[v("â™»ï¸")]),_:1},8,["class"])]),_:1})]),_:1})]),_:1}),C.value?(i(),t(s,{key:0,class:"period-info"},{default:n(()=>[d(s,{class:"period-card"},{default:n(()=>[d(l,{class:"period-icon"},{default:n(()=>[v("ðŸ“Š")]),_:1}),d(s,{class:"period-content"},{default:n(()=>[d(l,{class:"period-title"},{default:n(()=>[v("ç»Ÿè®¡å‘¨æœŸ")]),_:1}),d(l,{class:"period-desc"},{default:n(()=>[v("è¿‡åŽ»30å¤© ("+y(A(C.value.period_range.start))+" - "+y(A(C.value.period_range.end))+")",1)]),_:1})]),_:1})]),_:1})]),_:1})):f("",!0),d(s,{class:"ranking-content"},{default:n(()=>[D.value?(i(),t(s,{key:0,class:"loading-section"},{default:n(()=>[d(s,{class:"loading-spinner"}),d(l,{class:"loading-text"},{default:n(()=>[v("åŠ è½½æŽ’è¡Œæ¦œä¸­...")]),_:1})]),_:1})):C.value&&C.value.ranking.length>0?(i(),t(s,{key:1,class:"ranking-list"},{default:n(()=>[d(s,{class:"top-three"},{default:n(()=>[(i(!0),_(m,null,p(C.value.ranking.slice(0,3),(a,e)=>(i(),t(s,{key:a.rank,class:h(["top-item","rank-"+a.rank])},{default:n(()=>[d(s,{class:"rank-medal"},{default:n(()=>[d(l,{class:"medal-icon"},{default:n(()=>{return[v(y((e=a.rank,{1:"ðŸ¥‡",2:"ðŸ¥ˆ",3:"ðŸ¥‰"}[e]||"ðŸ…")),1)];var e}),_:2},1024),d(s,{class:"medal-glow"})]),_:2},1024),d(s,{class:"top-user-info"},{default:n(()=>[d(l,{class:"top-username"},{default:n(()=>[v(y(a.username),1)]),_:2},1024),d(l,{class:"top-points"},{default:n(()=>[v(y(a.monthly_points)+"åˆ†",1)]),_:2},1024),d(l,{class:"top-count"},{default:n(()=>[v(y(a.monthly_count)+"æ¬¡",1)]),_:2},1024)]),_:2},1024),d(s,{class:"podium-base"})]),_:2},1032,["class"]))),128))]),_:1}),d(s,{class:"ranking-table"},{default:n(()=>[d(s,{class:"table-header"},{default:n(()=>[d(l,{class:"header-rank"},{default:n(()=>[v("æŽ’å")]),_:1}),d(l,{class:"header-user"},{default:n(()=>[v("ç”¨æˆ·")]),_:1}),d(l,{class:"header-points"},{default:n(()=>[v("æœ¬æœˆç§¯åˆ†")]),_:1}),d(l,{class:"header-count"},{default:n(()=>[v("è¯†åˆ«æ¬¡æ•°")]),_:1})]),_:1}),(i(!0),_(m,null,p(C.value.ranking.slice(3),(a,e)=>{return i(),t(s,{key:a.rank,class:h(["table-row",{"my-rank":(r=a.username,r===L.value)}])},{default:n(()=>[d(s,{class:"rank-cell"},{default:n(()=>[d(l,{class:"rank-number"},{default:n(()=>[v(y(a.rank),1)]),_:2},1024)]),_:2},1024),d(s,{class:"user-cell"},{default:n(()=>[d(s,{class:"user-avatar"},{default:n(()=>[d(l,{class:"avatar-text"},{default:n(()=>[v(y(a.username.charAt(0)),1)]),_:2},1024)]),_:2},1024),d(l,{class:"username"},{default:n(()=>[v(y(a.username),1)]),_:2},1024)]),_:2},1024),d(s,{class:"points-cell"},{default:n(()=>[d(l,{class:"points-number"},{default:n(()=>[v(y(a.monthly_points),1)]),_:2},1024),d(l,{class:"points-unit"},{default:n(()=>[v("åˆ†")]),_:1})]),_:2},1024),d(s,{class:"count-cell"},{default:n(()=>[d(l,{class:"count-number"},{default:n(()=>[v(y(a.monthly_count),1)]),_:2},1024),d(l,{class:"count-unit"},{default:n(()=>[v("æ¬¡")]),_:1})]),_:2},1024)]),_:2},1032,["class"]);var r}),128))]),_:1})]),_:1})):(i(),t(s,{key:2,class:"empty-state"},{default:n(()=>[d(l,{class:"empty-icon"},{default:n(()=>[v("ðŸ“Š")]),_:1}),d(l,{class:"empty-title"},{default:n(()=>[v("æš‚æ— æŽ’è¡Œæ¦œæ•°æ®")]),_:1}),d(l,{class:"empty-desc"},{default:n(()=>[v("å¼€å§‹åžƒåœ¾åˆ†ç±»ï¼Œäº‰å¤ºçŽ¯ä¿æ¦œé¦–ï¼")]),_:1})]),_:1}))]),_:1}),C.value?(i(),t(s,{key:1,class:"stats-footer"},{default:n(()=>[d(s,{class:"stats-card"},{default:n(()=>[d(s,{class:"stats-item"},{default:n(()=>[d(l,{class:"stats-value"},{default:n(()=>[v(y(C.value.total_users),1)]),_:1}),d(l,{class:"stats-label"},{default:n(()=>[v("å‚ä¸Žç”¨æˆ·")]),_:1})]),_:1}),d(s,{class:"stats-divider"}),d(s,{class:"stats-item"},{default:n(()=>[d(l,{class:"stats-value"},{default:n(()=>{return[v(y((a=C.value.update_time,new Date(a).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}))),1)];var a}),_:1}),d(l,{class:"stats-label"},{default:n(()=>[v("æ›´æ–°æ—¶é—´")]),_:1})]),_:1})]),_:1})]),_:1})):f("",!0)]),_:1})}}},[["__scopeId","data-v-aedc7718"]]);export{j as default};
