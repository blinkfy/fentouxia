import{g as e,B as o,C as t,D as n,s as i,T as a}from"./index-DWDfi1U8.js";import{b as r}from"./index.D9Dqt54M.js";function s(s){return new Promise((d,c)=>{const f=e("token")||"";let l=!1;try{const e=o?o():t(),i=n?n():t(),a=e.platform;l="web"===i.uniPlatform||"devtools"===a&&"undefined"!=typeof window&&window.location||"undefined"!=typeof document&&"undefined"!=typeof window&&!window.wx&&!window.my}catch(u){l="undefined"!=typeof window&&"undefined"!=typeof document}if(l&&s instanceof File){const e=new FormData;e.append("image",s),fetch(`${r}/api/recognize`,{method:"POST",headers:{Authorization:f},body:e}).then(e=>{if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);return e.json()}).then(e=>{0===e.code?d(e.data):(i({title:e.msg||"识别失败",icon:"none"}),c(e))}).catch(e=>{console.error("H5 fetch上传失败:",e),i({title:"图片上传失败",icon:"none"}),c(e)})}else a({url:`${r}/api/recognize`,filePath:"string"==typeof s?s:s.path,name:"image",formData:{},header:{Authorization:f},success:e=>{let o=e.data;if("string"==typeof o)try{o=JSON.parse(o)}catch(u){}0===o.code?d(o.data):(i({title:o.msg||"识别失败",icon:"none"}),c(o))},fail:e=>{console.error("uni.uploadFile上传失败:",e),i({title:"图片上传失败",icon:"none"}),c(e)}})})}export{s as r};
